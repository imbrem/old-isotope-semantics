%% Commands for TeXCount
%TC:macro \cite [option:text,text]
%TC:macro \citep [option:text,text]
%TC:macro \citet [option:text,text]
%TC:envir table 0 1
%TC:envir table* 0 1
%TC:envir tabular [ignore] word
%TC:envir displaymath 0 word
%TC:envir math 0 word
%TC:envir comment 0 0

\documentclass[acmsmall,screen,review]{acmart}

\usepackage{syntax}
\renewcommand{\syntleft}{\normalfont\itshape}
\renewcommand{\syntright}{\normalfont\itshape}

\usepackage{prftree}

\newcounter{todos}
\newcommand{\TODO}[1]{{
  \stepcounter{todos}
  \begin{center}\large{\textcolor{red}{\textbf{TODO \arabic{todos}:} #1}}\end{center}
}}
\newcommand{\sorry}{\textcolor{red}{\textbf{sorry}}}

% Math fonts
\newcommand{\mc}[1]{\ensuremath{\mathcal{#1}}}
\newcommand{\mb}[1]{\ensuremath{\mathbf{#1}}}
\newcommand{\ms}[1]{\ensuremath{\mathsf{#1}}}

% Syntax atoms
\newcommand{\lbl}[1]{{`#1}}
\newcommand{\lto}{\Rightarrow}
\newcommand{\ctt}{\ms{tt}}
\newcommand{\cff}{\ms{ff}}

% Syntax
\newcommand{\letexpr}[3]{\ensuremath{\ms{let}\;#1 = #2\;\ms{in}\;#3}}
\newcommand{\letstmt}[3]{\ensuremath{\ms{let}\;#1 = #2; #3}}
\newcommand{\brb}[2]{\ms{br}\;#1\;#2}
\newcommand{\lbrb}[2]{\brb{\lbl{#1}}{#2}}
\newcommand{\ite}[3]{\ms{if}\;#1\;\{#2\}\;\ms{else}\;\{#3\}}
\newcommand{\ewhere}[2]{\ms{then}\;#1\;\ms{where}\;#2}
\newcommand{\where}[2]{#1\;\ms{where}\;#2}
\newcommand{\wbranch}[3]{#1(#2) \lto #3}
\newcommand{\lwbranch}[3]{\wbranch{\lbl{#1}}{#2}{#3}}
\newcommand{\bsplice}[3]{#1(#2)\;\{#3\}}
\newcommand{\lbsplice}[3]{\bsplice{\lbl{#1}}{#2}{#3}}
\newcommand{\csplits}[3]{#1 \mapsto #2;#3}
\newcommand{\cwk}[2]{#1 \mapsto #2}
\newcommand{\lwk}[2]{#1 \rightsquigarrow #2}
\newcommand{\tlin}[2]{\ms{lin}_{#2}(#1)}
\newcommand{\ltlin}[3]{\ms{lin}_{#3}(#1^{#2})}
\newcommand{\thyp}[3]{#1: {#2}^{#3}}
\newcommand{\lhyp}[3]{#1[#2](#3)}
\newcommand{\llhyp}[3]{\lhyp{\lbl{#1}}{#2}{#3}}
\newcommand{\rle}[1]{{\scriptsize\textsf{#1}}}
\newcommand{\taff}{\ms{a}}
\newcommand{\trel}{\ms{r}}
\newcommand{\tint}{\infty}
\newcommand{\hasty}[5]{#1 \vdash_{#2} #3: {#4}^{#5}}
\newcommand{\haslb}[3]{#1 \vdash #2 \rhd #3}
\newcommand{\lhaslb}[3]{#1 \vdash #2 \rhd #3}
\newcommand{\issubst}[3]{#1: #2 \mapsto #3}
\newcommand{\lbsubst}[3]{#1: #2 \rightsquigarrow #3}
\newcommand{\exprletsubst}[2]{{#1};{#2}}
\newcommand{\stmtletsubst}[2]{{#1};{#2}}
\newcommand{\mhole}[1]{{#1}^?}
\newcommand{\lhole}[1]{?#1}
\newcommand{\mhasty}[6]{#1;#2 \vdash_{#3} #4: {#5}^{#6}}
\newcommand{\mhaslb}[4]{#1;#2 \vdash #3 \rhd #4}
\newcommand{\mlhaslb}[4]{#1;#2 \vdash #3 \rhd #4}
\newcommand{\tyhole}[5]{#1: #2 \mapsto_{#3} {#4}^{#5}}
\newcommand{\blkhole}[3]{#1: #2 \mapsto #3}
\newcommand{\cfghole}[3]{#1: #2 \mapsto #3}
\newcommand{\substctx}[2]{{#1}^{#2}}
\newcommand{\substlbs}[2]{{#1}^{#2}}
\newcommand{\restrictsubst}[2]{{#1}_{#2}}
\newcommand{\subsubst}[2]{#1 \subseteq #2}
\newcommand{\isrw}[3]{#1: #2 \mapsto #3}
% \newcommand{\strictlbsubst}[3]{#1: #2 \rightsquigarrow_= #3}

% Denotational semantics
\newcommand{\dnt}[1]{\llbracket{#1}\rrbracket}
\newcommand{\ednt}[1]{\left\llbracket{#1}\right\rrbracket}
\newcommand{\upg}[2]{{#1}^{\uparrow #2}}

% Branding
\newcommand{\isotopessa}{\ms{isotope_{SSA}}}

%% Rights management information.  This information is sent to you
%% when you complete the rights form.  These commands have SAMPLE
%% values in them; it is your responsibility as an author to replace
%% the commands and values with those provided to you when you
%% complete the rights form.
% \setcopyright{acmcopyright}
% \copyrightyear{2018}
% \acmYear{2018}
% \acmDOI{XXXXXXX.XXXXXXX}

%%
%% These commands are for a JOURNAL article.
% \acmJournal{JACM}
% \acmVolume{37}
% \acmNumber{4}
% \acmArticle{111}
% \acmMonth{8}

%%
%% Submission ID.
%% Use this when submitting an article to a sponsored event. You'll
%% receive a unique submission ID from the organizers
%% of the event, and this ID should be used as the parameter to this command.
%%\acmSubmissionID{123-A56-BU3}

%%
%% The majority of ACM publications use numbered citations and
%% references.  The command \citestyle{authoryear} switches to the
%% "author year" style.
%%
%% If you are preparing content for an event
%% sponsored by ACM SIGGRAPH, you must use the "author year" style of
%% citations and references.
%% Uncommenting
%% the next command will enable that style.
%%\citestyle{acmauthoryear}

\begin{document}

\title{SSA is Freyd Categories}

\author{Jad Ghalayini}
\email{jeg74@cl.cam.ac.uk}
\orcid{0000-0002-6905-1303}

%%
%% Keywords. The author(s) should pick words that accurately describe
%% the work being presented. Separate the keywords with commas.
\keywords{TODO PUT KEYWORDS HERE}

% \received{20 February 2007}
% \received[revised]{12 March 2009}
% \received[accepted]{5 June 2009}

\maketitle

Static Single Assignment, or SSA, is a cornerstone of modern compiler design, on which projects such as the LLVM compiler infrastructure \cite{llvm}, GCC's GIMPLE IR \cite{gcc}, Cranelift \cite{cranelift}, and MLIR \cite{mlir} are based. One of the core advantages of putting programs in SSA form is the ability to reason about programs in a more equational manner: since variables always have exactly one definition, we can justify complex optimizations like global value numbering (which would otherwise need to take into account complex flow-sensitive definitions) and more easily implement various analyses.

One of the core observations of the MLIR project is that SSA is very widely applicable, being useful for representing everything from high-level machine learning operations to low-level GPU code, and even hardware designs, as in the CIRCT project \cite{circt}. This hints that SSA is a natural syntax for some fundamental compositional structure, much like how the simply typed lambda calculus is a natural syntax for Cartesian closed categories. 

In this talk, we would like to argue that SSA without control-flow is a syntax for \textit{Freyd categories}, which we then provide a graphical syntax for in terms of string diagrams as in \cite{promonad}. We then argue that SSA with \textit{terminating} control-flow (i.e., in which the basic blocks form a DAG) corresponds exactly to \textit{distributive} Freyd categories, while SSA with general control-flow corresponds to equipping a distributive Freyd category with an \textit{Elgot structure}; we then give a string-diagrammatic graphical representation of such programs based on traditional control-flow graphs.

We do this by providing a type-theoretic presentation of SSA, which we call \isotopessa, which is designed to be amenable to inductive proofs and definitions. By using this formalization, we can equip SSA with a categorical semantics, which we show satisfies important properties such as semantic substitution and congruence. We then show how various optimizations, such as strength reduction, constant propagation, global value numbering, loop hoisting, and E-graph rewriting are compatible with our semantics. Finally, we give various models of our categorical semantics exhibiting interesting features, building up to a simple model of TSO-style weak memory based on \cite{sparky} which treats the interactions between threads in a compositional manner.

Time permitting, we also hope to explain how to generalize our IR with support for substructural types and impure substitutions, which require us to move to the more general setting of \textit{distributive effectful categories}, and give a few applications of this more general system relating to separation logic, quantum computing, and nondeterminism.

\bibliographystyle{ACM-Reference-Format}
\bibliography{references}

\end{document}
\endinput
